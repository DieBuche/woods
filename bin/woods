#!/usr/bin/env node

var program = require('commander'),
	path = require('path'),
	fs = require('fs'),
	woods = require('../index');

// usage

program
	.version(require('../package').version)
	.usage('[directory]')
	.option('-p, --port [3000]', 'The server port', parseInt)
	.option('-s, --sync', 'Sync site to s3')
   .parse(process.argv);

if (!program.args.length)
	console.log('No site directory provided. Serving example site:');

var uri = path.resolve(__dirname, program.args[0] || '../example');
fs.exists(uri, function(exists) {
	if (exists) {
		woods.initialize(uri, program.port, function() {
			if (program.sync) {
				if (!woods.site) {
					console.log('Site not found: ' + program.sync);
					process.exit();
				}
				console.log('Exporting: ' + program.sync);
				woods.site.syncS3(function() {
					console.log('Done syncing: ' + program.sync);
					process.exit();
				});
			} else {
				console.log('Serving', woods.site.directory, 'on ' + woods.url);
			}
		});
	} else {
		console.log('Site directory not found: ', uri);
		process.exit();
	}
});
